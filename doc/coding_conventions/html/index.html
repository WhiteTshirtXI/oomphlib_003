<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>oomph-lib</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="doxygen.css">
<link rel="stylesheet" type="text/css" href="../../oomph_header.css">
<!-- The  following script does the hide/show trick-->
<script language="JavaScript" type="text/javascript" 
        src="../../navbar_toggle.js" >
</script>
<!-- The  following script
 ensures that the required field on the download form get filled in-->
<script language="JavaScript">
<!--
function formCheck(formobj){
    // mandatory fields
    var fieldRequired = Array("name", "affiliation", "email", "why");
    // description to appear in the dialog box
    var fieldDescription = Array("name", "affiliation", "email", 
                                 "Why are you interested in oomph-lib?");
    // dialog message
    var alertMsg = "Please complete the following fields:\n";
    var l_Msg = alertMsg.length;
    for (var i = 0; i < fieldRequired.length; i++){
        var obj = formobj.elements[fieldRequired[i]];
        if (obj){
            switch(obj.type){
            case "select-one":
                if (obj.selectedIndex == -1 || 
                    obj.options[obj.selectedIndex].text == ""){
                    alertMsg += " - " + fieldDescription[i] + "\n";
                }
                break;
            case "select-multiple":
                if (obj.selectedIndex == -1){
                    alertMsg += " - " + fieldDescription[i] + "\n";
                }
                break;
            case "text":
            case "textarea":
                if (obj.value == "" || obj.value == null){
                    alertMsg += " - " + fieldDescription[i] + "\n";
                }
                break;
            default:
            }
            if (obj.type == undefined){
                var blnchecked = false;
                for (var j = 0; j < obj.length; j++){
                    if (obj[j].checked){
                        blnchecked = true;
                    }
                }
                if (!blnchecked){
                    alertMsg += " - " + fieldDescription[i] + "\n";
                }
            }
        }
    }
    if (alertMsg.length == l_Msg){
        return true;
    }else{
        alert(alertMsg);
        return false;
    }
}
// -->
</script>
<body onLoad="visibilitytoggle()"> <!-- This is required for the "Click'n'view" fct to work! -->
<div class="header">
<p class="logo"><a href="../../../doc/html/index.html"><img src="../../../doc/figures/oomph.png" alt="oomph-lib logo: Link to oomph-lib homepage" border=0></a></p>
<div class="head-section">
<div id="hotspot" name="hotspot" class="hotspot" 
     title="click to expand the navigation menu">Documentation,<br/>
     example codes and tutorials</div> 
<dl style="" id="toggle" name="toggle" class="toggle">  
<dt><a href="../../../doc/index/html/index.html">Index</a></dt>
<dt><a href="../../../doc/example_code_list/html/index.html">List of tutorials/demo codes</a></dt>
<dt><a href="../../../doc/quick_guide/html/index.html">The (Not-so) Quick Guide</a></dt>
<dt><a href="../../../doc/intro/html/index.html">FE theory and top-down discussion of the data structure</a></dt>
      <dt><a href="../../../doc/the_data_structure/html/index.html">Comprehensive bottom-up discussion of the data
      structure</a></dt>
      <dt><a href="../../../doc/paraview/html/index.html"> Visualisation of the results </a></dt>
      <dt><a href="../../../doc/coding_conventions/html/index.html">Coding conventions and C++ style</a></dt>
      <dt><a href="../../../doc/creating_doc/html/index.html">Creating documentation</a></dt>
      <dt><a href="../../../doc/optimisation/html/index.html">Optimisation</a>
      </dt> 
</dl>
</div><!-- end section-->
<div class="head-section">
<div id="hotspot" name="hotspot" class="hotspot" 
     title="click to expand the navigation menu">Parallel Processing</div> 
<dl style="" id="toggle" name="toggle" class="toggle">  
      <dt><a href="../../../doc/mpi/general_mpi/html/index.html"> Overview </a></dt>
     <dt><a href="../../../doc/mpi/distributed_linear_algebra_infrastructure/html/index.html">
     Distributed Linear Algebra </a></dt>
     <dt><a href="../../../doc/mpi/distributed_block_preconditioners/html/index.html">
     Distributed Block Preconditioners </a></dt>
     <dt><a href="../../../doc/mpi/distributed_general_purpose_block_preconditioners/html/index.html">
     Distributed General-Purpose Block Preconditioners </a></dt>
</dl>
</div>
<div class="head-section">
<div id="hotspot" name="hotspot" class="hotspot" 
     title="click to expand the navigation menu"> Publications</div> 
<dl style="" id="toggle" name="toggle" class="toggle">  
    <dt><a href="../../../doc/publications/html/index.html">Publications</a>
      <dd><a href="../../../doc/publications/html/index.html#talks">Talks</a></dd>
      <dd><a href="../../../doc/publications/html/index.html#papers">Journal publications</a></dd>
      <dd><a href="../../../doc/publications/html/index.html#theses">Theses</a></dd>
    </dt>
    <dt><a href="../../../doc/picture_show/index.html">Picture show </a></dt>
</dl>
</div><!-- end section-->
<div class="head-section">
<div id="hotspot" name="hotspot" class="hotspot" 
     title="click to expand the navigation menu"> Download</div> 
<dl style="" id="toggle" name="toggle" class="toggle">  
    <dt><a href="../../../doc/copyright/html/index.html">Copyright</a></dt>
    <dt><a href="../../../doc/the_distribution/html/index.html">Download/installation instructions</a></dt>
    <dt><a href="../../../doc/download/html/index.html">Download page</a></dt>
</dl>
</div><!-- end section-->
<div class="head-section">
<div id="hotspot" name="hotspot" class="hotspot" 
     title="click to expand the navigation menu">FAQ & Contact</div> 
<dl style="" id="toggle" name="toggle" class="toggle">  
    <dt><a href="../../../doc/FAQ/html/index.html">FAQ</a></dt>
    <dt><a href="../../../doc/change_log/html/index.html">Change log</a></dt>
    <dt><a href="../../../doc/bugs/html/index.html">Bugs and other known problems</a></dt>
    <dt><a href="../../../doc/ToDo/html/index.html">Completeness of the library & our "To-Do List" </a></dt>
    <dt><a href="../../../doc/contact/html/index.html">Contact the developers</a></dt>
    <dt><a href="../../../doc/get_involved/html/index.html">Get involved </a></dt>
</dl>
</div><!-- end section-->
<p class="clear">&nbsp;</p>
</div><!-- end header -->
<P>
<HR>
<TABLE BORDER=1, WIDTH=700px>
<TR>
<TD bgcolor="cornsilk">
<CENTER><B>Beta release!</b></CENTER><br>
Please note that the library has not been "officially" released.
While we continue to work on the documentation, these web pages
are likely to contain broken links and documents in draft form. 
Please send an email to 
<BR><BR>
<CENTER>
<TT>oomph-lib AT maths DOT man DOT ac DOT uk</TT>
</CENTER>
<BR> 
if you wish to be informed of the library's "official" release.
</TD>
</TR>
</TABLE>
</CENTER>
<HR>
<script type="text/javascript">
 function index_toggle(id,img) {
  var e = document.getElementById(id);
  var im = document.getElementById(img);
  if (e.style.display == '')
   {
      e.style.display = 'none';
      im.src="../expand.png";
   }
  else
   {
   e.style.display = '';
   im.src = "../collapse.png";
   }
 }
</script>
</head>
<!-- Generated by Doxygen 1.8.1.2 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Coding conventions and C++-style </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document provides an overview of the general coding conventions that are used throughout <code>oomph-lib</code>. Knowledge of these conventions will greatly facilitate the use of the library. Contributors to the library are expected to adhere to these standards.</p>
<hr/>
 <hr/>
<h1><a class="anchor" id="naming"></a>
Naming conventions</h1>
<h2><a class="anchor" id="filenames"></a>
File names</h2>
<p>All C++ source files end with the standard extensions *.h and *.cc.</p>
<ul>
<li><code>*</code>.h: Contains the class definitions and any inline functions.</li>
<li><code>*</code>.cc: Contains all non-inline member functions that can be compiled once and for all. This includes<ul>
<li>member functions of classes that do not have any template parameters</li>
<li>member functions of templated classes for which it is known a priori which instantiations are required. Examples are classes that are templated by the spatial dimension. In this case we're unlikely to require instantiations for any values other than 0,1,2 and 3.</li>
</ul>
</li>
<li><code>*</code>.template.cc: Contains any non-inline member function of templated classes. This file must be included (together with the corresponding <code>*</code>.h file) when a specific instantiation of a templated class is required. For instance, most specific <code>Mesh</code> classes are templated by the element type and the mesh writer can obviously not predict which element types his/her specific mesh is going to be used with.</li>
</ul>
<h2><a class="anchor" id="variables"></a>
General variables</h2>
<ul>
<li>General variables are all lowercase</li>
<li>Variables that contain multiple words contain underscores to separate them, e.g. <div class="fragment"><div class="line">FiniteElement* surface_element_pt; </div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="classes"></a>
Classes</h2>
<ul>
<li>Classes start with capital letter, e.g. <div class="fragment"><div class="line"><span class="keyword">class </span>Shape </div>
</div><!-- fragment --></li>
</ul>
<ul>
<li>If the class name contains multiple words, the first letter of any subsequent word also gets capitalised, e.g. <div class="fragment"><div class="line"><span class="keyword">class </span>AlgebraicElement </div>
</div><!-- fragment --> <b>Note:</b> No underscores in class names.</li>
</ul>
<h2><a class="anchor" id="private_public"></a>
Private data and access functions to  private data</h2>
<p>Use a capital first letter for private data, and the all-lowercase equivalent for the access functions. Examples:</p>
<ul>
<li>This is a declaration for a private data member: <div class="fragment"><div class="line"><span class="keyword">private</span>: </div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /// Pointer to boundary node</span></div>
<div class="line"><span class="comment"></span>  Node* Boundary_node_pt; </div>
</div><!-- fragment --></li>
<li>Here are two public access functions to the private data member: <div class="fragment"><div class="line"><span class="keyword">public</span>: </div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"> /// Access to boundary node (const version)</span></div>
<div class="line"><span class="comment"></span> Node* boundary_node_pt()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Boundary_node_pt;}</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"> /// Access to boundary node</span></div>
<div class="line"><span class="comment"></span> Node*&amp; boundary_node_pt() {<span class="keywordflow">return</span> Boundary_node_pt;}</div>
</div><!-- fragment --></li>
</ul>
<p><b>Note:</b> Do <b>not</b> use public data &ndash; ever! Make it private and and provide an access function &ndash; even if it seems "perfectly
 obvious" at the time of writing the class that the internal storage for the data item is "never going to be changed".</p>
<h2><a class="anchor" id="pointers"></a>
Pointers</h2>
<ul>
<li>Pointers and access functions to pointers are identified explicitly by the postfix <em>_pt</em> to the variable names, as shown in the previous examples.</li>
</ul>
<h2><a class="anchor" id="numbering"></a>
Access functions to containers</h2>
<p>Many classes have member functions that provide access to data in private containers (e.g. vectors); they are usally accompanied by a member function that returns the number of entries in that container. Naming conventions:</p>
<ul>
<li>Use singular for the access function to the container, i.e. <div class="fragment"><div class="line"><span class="comment">/// Return pointer to e-th element</span></div>
<div class="line"><span class="comment"></span>FiniteElement* element_pt(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; e);</div>
</div><!-- fragment --> rather than <code>elements_pt</code>(...)</li>
<li>Use a prefix `<code>n'</code> for the access function for the number of entries in the container, i.e. <div class="fragment"><div class="line"><span class="comment">/// Total number of elements </span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">unsigned</span> nelement();</div>
</div><!-- fragment --> <b>Notes:</b> (i) No underscore betweeen the "n" and the container's name. (ii) No trailing <code>_pt</code> in the function that returns the number of objects in the container.</li>
</ul>
<h2><a class="anchor" id="template"></a>
Template parameters</h2>
<ul>
<li>Template parameters are all caps, e.g. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;</div>
<div class="line"><span class="keyword">class </span>NavierStokesEquations</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">  [...]</div>
<div class="line"></div>
<div class="line">};</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="verbose"></a>
Use descriptive function/variable names</h2>
<ul>
<li>Make sure you choose descriptive names for functions and variables, even if the names become long.</li>
</ul>
<hr/>
 <hr/>
<h1><a class="anchor" id="layout"></a>
Layout etc.</h1>
<h2><a class="anchor" id="include_files"></a>
Position of include statements</h2>
<ul>
<li>Place include statements at the beginning of each file.</li>
</ul>
<h2><a class="anchor" id="layout_blocks"></a>
Layout of blocks</h2>
<ul>
<li>Braces on separate lines (unless the content is extremely short) <div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;10;i++)</div>
<div class="line">  {</div>
<div class="line"></div>
<div class="line">   [...]</div>
<div class="line"></div>
<div class="line">   std::cout &lt;&lt; <span class="stringliteral">&quot;doing something&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">   [...]</div>
<div class="line"></div>
<div class="line">  }</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="indentation"></a>
Indentation</h2>
<ul>
<li>Indentation of blocks etc. should follow the emacs standards.</li>
</ul>
<h2><a class="anchor" id="layout_functions_etc"></a>
Layout of functions, classes, etc.</h2>
<ul>
<li>Precede all functions by a comment block, enclosed between lines of `===' <div class="fragment"><div class="line"><span class="comment">// =============================================================</span><span class="comment"></span></div>
<div class="line"><span class="comment">/// \short (add \short to make sure that multi-line descriptions</span></div>
<div class="line"><span class="comment">/// appear in doxygen&#39;s short documentation. Include lists with items</span></div>
<div class="line"><span class="comment">/// - first item</span></div>
<div class="line"><span class="comment">/// - second item</span></div>
<div class="line"><span class="comment">///   - first item of sublist</span></div>
<div class="line"><span class="comment">///   - second item of sublist</span></div>
<div class="line"><span class="comment">///   . //end of sublist</span></div>
<div class="line"><span class="comment">/// . //end of main list</span></div>
<div class="line"><span class="comment"></span><span class="comment">// =============================================================</span></div>
<div class="line"><span class="keywordtype">void</span> SomeClass::some_function()</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;10;i++)</div>
<div class="line">  {</div>
<div class="line">   std::cout &lt;&lt; <span class="stringliteral">&quot;doing something&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> }</div>
</div><!-- fragment --> Note the triple slash "///" in the comment block that preceeds the function definition &ndash; comments contained in such lines are automatically extracted by doxygen and inserted into the code documentation.</li>
</ul>
<h2><a class="anchor" id="oomph"></a>
The oomph-lib namespace</h2>
<ul>
<li><code>oomph-lib</code> is contained in its own namespace, <code>oomph</code>, to avoid clashes of class names with those of other (third-party) libraries. If there is no danger of name clashes, the entire <code>oomph</code> namespace may be imported at the beginning of each driver code by placing the statement <div class="fragment"><div class="line"><span class="keyword">using namespace </span>oomph;</div>
</div><!-- fragment --> at the beginning of the source code (after the included header files). Any additions to the library (this includes the instantiation of templated <code>oomph-lib</code> classes inside a driver code!) must be included into the <code>oomph</code> namespace by surrounding the code by <div class="fragment"><div class="line"><span class="keyword">namespace </span>oomph</div>
<div class="line"> {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Additions to the library go here...</span></div>
<div class="line">    [...]</div>
<div class="line"> </div>
<div class="line"> }</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="std"></a>
Namespace pollution</h2>
<ul>
<li>To avoid namespace pollution, the namespace <code>std</code> <b>must</b> <b>not</b> be included globally in any header files. The statement <div class="fragment"><div class="line"><span class="keyword">using namespace </span>std;</div>
</div><!-- fragment --> may only be used in driver codes, in *.cc files, or inside specific functions in a *.h file.</li>
</ul>
<h2><a class="anchor" id="layout_classes"></a>
Layout of class definitions and include guards.</h2>
<p>Here is an example of a complete header file, including include guards and library includes. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef OOMPH_SOME_CLASS_HEADER     // Assuming that the file is </span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define OOMPH_SOME_CLASS_HEADER     // called some_class.h</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">// Include generic oomph-lib library</span></div>
<div class="line"><span class="preprocessor">#include &quot;generic.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Add to oomph-lib namespace</span></div>
<div class="line"><span class="keyword">namespace </span>oomph</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line"><span class="comment">// =============================================================</span><span class="comment"></span></div>
<div class="line"><span class="comment">/// Waffle about what the class does etc.</span></div>
<div class="line"><span class="comment">/// </span></div>
<div class="line"><span class="comment"></span><span class="comment">// =============================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>SomeClass : <span class="keyword">public</span> SomeBaseClass</div>
<div class="line"> {</div>
<div class="line">   <span class="keyword">public</span>: </div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    /// Constructor: Pass coefficients n1 and n2</span></div>
<div class="line"><span class="comment"></span>    SomeClass(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; n1, <span class="keyword">const</span> T&amp; n2) : N1(n1), N2(n2)</div>
<div class="line">     {}</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    /// Access function to coefficient </span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> n1()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">     </span>{</div>
<div class="line">      <span class="keywordflow">return</span> N1;</div>
<div class="line">     }</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    /// Access function to other coefficient</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">inline</span> T&amp; n2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">     </span>{</div>
<div class="line">      <span class="keywordflow">return</span> N2;</div>
<div class="line">     }</div>
<div class="line">   </div>
<div class="line"></div>
<div class="line">   <span class="keyword">protected</span>:</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">      /// Coefficient </span></div>
<div class="line"><span class="comment"></span>      <span class="keywordtype">unsigned</span> N1;</div>
<div class="line"></div>
<div class="line">   <span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">      /// Second coefficient</span></div>
<div class="line"><span class="comment"></span>      T  N2;</div>
<div class="line"></div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line"> } </div>
<div class="line"><span class="preprocessor"> #endif</span></div>
</div><!-- fragment --><ul>
<li>Order of public/protected/private may be reversed but the declarations should always be explicit (even though everything is private by default).</li>
<li>Note the prefix <code> OOMPH_*</code> in the include guard. This is to avoid clashes with include guards of other libraries.</li>
</ul>
<hr/>
 <hr/>
<h1><a class="anchor" id="debug"></a>
Debugging etc.</h1>
<h2><a class="anchor" id="paranoia"></a>
The PARANOID flag and error handling</h2>
<ul>
<li>Implement optional validation routines, self-tests, and other sanity checks via conditional compilation, using the compiler flag PARANOID, so that the relevant statements are only activated if <code>-DPARANOID</code> is specified as a compilation flag for the C++ compiler. If errors are detected, a meaningful diagnostic should be issued, by throwing an <code>OomphLibError</code>. If the code is compiled without the PARANOID flag, all sanity checks are bypassed &ndash; good for the overall execution speed, bad for error handling... The user can choose. <br/>
<br/>
 Here's an example: <br/>
<br/>
 <div class="fragment"><div class="line"><span class="comment">//Has a global mesh already been built?</span></div>
<div class="line"><span class="keywordflow">if</span>(Mesh_pt!=0)</div>
<div class="line"> {</div>
<div class="line">  std::string error_message = </div>
<div class="line">   <span class="stringliteral">&quot;Problem::build_global_mesh() called,\n&quot;</span>;</div>
<div class="line">  error_message += <span class="stringliteral">&quot; but a global mesh has already been built:\n&quot;</span>;</div>
<div class="line">  error_message += <span class="stringliteral">&quot;Problem::Mesh_pt is not zero!\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">throw</span> OomphLibError(error_message,</div>
<div class="line">                      <span class="stringliteral">&quot;Problem::build_global_mesh()&quot;</span>,</div>
<div class="line">                      OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"> }</div>
</div><!-- fragment --></li>
<li><code>oomph-lib</code> also has an object that allows warning messages to be issued in a uniform format. Here's an example of its use: <div class="fragment"><div class="line"><span class="comment">// Was it a duplicate?</span></div>
<div class="line"><span class="keywordtype">unsigned</span> nel_now=element_set_pt.size();</div>
<div class="line"><span class="keywordflow">if</span> (nel_now==nel_before)</div>
<div class="line"> {</div>
<div class="line">  std::ostringstream warning_stream;</div>
<div class="line">  warning_stream  &lt;&lt;<span class="stringliteral">&quot;WARNING: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt;<span class="stringliteral">&quot;Element &quot;</span> &lt;&lt; e &lt;&lt; <span class="stringliteral">&quot; in submesh &quot;</span> &lt;&lt; imesh </div>
<div class="line">                  &lt;&lt;<span class="stringliteral">&quot; is a duplicate \n and was ignored when assembling &quot;</span> </div>
<div class="line">                  &lt;&lt;<span class="stringliteral">&quot;global mesh.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  OomphLibWarning(warning_stream.str(),</div>
<div class="line">                  <span class="stringliteral">&quot;Problem::rebuild_global_mesh()&quot;</span>,</div>
<div class="line">                  OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"> }</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="range"></a>
Range checking</h2>
<ul>
<li>Most access functions that provide indexed access to a private container, do, in fact, access a private STL vector. Explicit range checking for these (frequent!) cases can be avoided by changing to container to Vector class instead. Vectors performs automatic range checking, if the <code>generic</code> library is compiled with the <code>RANGE_CHECKING</code> flag, i.e. if <code>-DRANGE_CHECKING</code> is specified as a compilation flag for the C++ compiler. <b>Note:</b> While it is generally a good idea to compile with <code>PARANOID</code> while developing code, <code>RANGE_CHECKING</code> is <b>very</b> <b>expensive</b> and is therefore activated via a second independent flag. We only tend to active this flag as a last resort, typically to track down particularly stubborn segmentation faults.</li>
</ul>
<h2><a class="anchor" id="self_test"></a>
Self test routines</h2>
<ul>
<li>Every sufficiently complex class should come with its own <div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> self_test() </div>
</div><!-- fragment --> routine which returns 1 for failure, 0 for successful test.</li>
</ul>
<hr/>
 <hr/>
<h1><a class="anchor" id="other"></a>
Other conventions</h1>
<h2><a class="anchor" id="constness"></a>
Const-ness</h2>
<ul>
<li>Use const whereever applicable (arguments, member functions,...)</li>
<li>Always provide const and non-const overloaded subscript operators.</li>
<li>Example: <div class="fragment"><div class="line"><span class="comment">// Return i-th coordinate of Point</span></div>
<div class="line"> <span class="keywordtype">double</span>&amp; operator[](<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; i){<span class="keywordflow">return</span> x[i];}  </div>
<div class="line"></div>
<div class="line"><span class="comment">// Return i-th coordinate of Point -- const version</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>&amp; operator[](<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; i)<span class="keyword"> const </span>{<span class="keywordflow">return</span> x[i];} </div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="unsigned"></a>
Only use int if a variable can actually take negative values</h2>
<ul>
<li>Just as the name of a variable gives some indication of its likely use, its type does too. For instance this code fragment <br/>
 <div class="fragment"><div class="line"><span class="comment">// Create a counter</span></div>
<div class="line"><span class="keywordtype">int</span> counter=0;</div>
</div><!-- fragment --> <br/>
 immediately raises the question why the programmer anticipates circumstances in which the counter might be negative. Are negative values used to indicate special cases; etc? If the name of the variable was chosen correctly (i.e. if the variable really is used as a counter) then <br/>
 <div class="fragment"><div class="line"><span class="comment">// Create a counter</span></div>
<div class="line"><span class="keywordtype">unsigned</span> counter=0;</div>
</div><!-- fragment --> <br/>
 is much clearer and therefore preferable, even if the two versions of the code would, of course, give the same result.</li>
</ul>
<h2><a class="anchor" id="pass_by_reference"></a>
Only use "pass by reference"</h2>
<ul>
<li>Arguments to functions should only be passed "by reference", not "by value". Use "pass by constant reference" if you want to ensure the const-ness of any (input) arguments.</li>
<li>To "encourage" this behaviour, most <code>oomph-lib</code> objects have (deliberately) broken copy constructors and assignment operators, making a "pass by value" impossible. The only exceptions are cases in which we could see a good reason why a fully-functional, non-memory-leaking copy/assignment operator might be required.</li>
</ul>
<h2><a class="anchor" id="break_copy"></a>
Provide fully-functional or deliberately-broken copy constructors and assignment operators</h2>
<ul>
<li>For the reasons mentioned above, "passing by value" is discouraged and we have only implemented copy constructors for very few classes. To make the use of C++'s default copy constructor impossible (as their accidental use may lead to serious memory leaks) all classes should either have a deliberately-broken copy constructor or provide a "proper" implementation (as in the case of <code>oomph-lib's</code> <code>Vector</code> class). The same applies to assignment operators. <br/>
 <br/>
 The namespace <code>BrokenCopy</code> provides two helper functions, <code>BrokenCopy::broken_copy</code>(...) and <code>BrokenCopy::broken_assign</code>(...) that issue a suitable error message and then throw an <code>OomphLibError</code>. The name of the class should be passed to these functions as a string, as in this example from the <code>Mesh</code> class: <br/>
<br/>
 <div class="fragment"><div class="line"><span class="comment">/// Broken copy constructor</span></div>
<div class="line"><span class="comment"></span>Mesh(<span class="keyword">const</span> Mesh&amp; dummy) </div>
<div class="line"> { </div>
<div class="line">  BrokenCopy::broken_copy(<span class="stringliteral">&quot;Mesh&quot;</span>);</div>
<div class="line"> } </div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/// Broken assignment operator</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> operator=(<span class="keyword">const</span> Mesh&amp;) </div>
<div class="line"> {</div>
<div class="line">  BrokenCopy::broken_assign(<span class="stringliteral">&quot;Mesh&quot;</span>);</div>
<div class="line"> }</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="order_of_args"></a>
Order of arguments</h2>
<ul>
<li>If values are returned from a function, put them at the end of the argument list.</li>
<li>"Time" arguments always come first, e.g. <div class="fragment"><div class="line"><span class="comment">/// \short Return FE interpolated coordinate x[i] at local coordinate s</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// at previous timestep t (t=0: present; t&gt;0: previous timestep)</span></div>
<div class="line"><span class="comment"></span><span class="keyword">virtual</span> <span class="keywordtype">double</span> interpolated_x(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; t, </div>
<div class="line">                              <span class="keyword">const</span> Vector&lt;double&gt; &amp;s,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;i) <span class="keyword">const</span>;</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="brackets"></a>
Access to elements in containers</h2>
<ul>
<li>Avoid access via square brackets (i.e. via operators) and write access functions instead, as they can be overloaded more easily.</li>
</ul>
<h2><a class="anchor" id="boolean"></a>
Boolean member data</h2>
<ul>
<li>Avoid access to boolean member data via trivial wrapper functions that return references. These constructions lead to somewhat ugly driver codes and can lead to code that appears to set a boolean, when it does not. Instead the status of the boolean should be modified by two set/unset or enable/disable subroutines (i.e. returning void) and tested using a (const) has_ or is_ function that returns a bool . For example <div class="fragment"><div class="line"><span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><span class="comment">  /// Boolean to indicate whether documentation should be on or off</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">bool</span> Doc_flag;</div>
<div class="line"><span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><span class="comment">  /// Enable documentation</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">void</span> enable_doc() {Doc_flag=<span class="keyword">true</span>;}<span class="comment"></span></div>
<div class="line"><span class="comment">  /// Disable documentation</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">void</span> disable_doc() {Doc_flag=<span class="keyword">false</span>;}<span class="comment"></span></div>
<div class="line"><span class="comment">  /// Test whether documentation is on or off</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">bool</span> is_doc_enabled()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Doc_flag;}</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="dont_use_macros"></a>
Macros</h2>
<ul>
<li>Don't use macros! There is a single exception to this rule: We use the macro <code>OOMPH_EXCEPTION_LOCATION</code> to make the file name and line number available to the <code>OomphLibException</code> object &ndash; the object that is thrown if a run-time error is detected.</li>
</ul>
<h2><a class="anchor" id="inlining"></a>
Inlining</h2>
<ul>
<li>Inline all simple set/get functions by placing them into the *.h file.</li>
<li><b>Careful:</b> Inlined functions should not contain calls to member functions of classes that are defined in other files as this can lead to triangular dependencies.</li>
</ul>
<hr/>
 <hr/>
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Dec 22 2012 19:07:55 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
